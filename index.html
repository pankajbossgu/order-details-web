<body>
  <h1>Order Details Lookup</h1>
  <input type="text" id="orderId" placeholder="Enter Order ID">
  <button onclick="fetchOrderDetails()">Get Details</button>
  <div id="result"></div>

  <script>
    const webAppURL = "https://script.google.com/macros/s/AKfycbz_-0fPNGDxbZj1R2H3JzmmDet3KL5WMcxE3-KG1HTC74nkR4fWPsJHdIguXyNY16xj/exec";

    async function fetchOrderDetails() {
      const orderId = document.getElementById("orderId").value.trim();

      if (!orderId) {
        document.getElementById("result").innerText = "Please enter an Order ID.";
        return;
      }

      const response = await fetch(`${webAppURL}?orderId=${orderId}`);
      const data = await response.json();

      if (data.error) {
        document.getElementById("result").innerText = data.error;
        return;
      }

      document.getElementById("result").innerHTML = `
        <div>
          <p><b>Order ID:</b> ${data["ORDER ID"]}</p>
          <p><b>Customer Name:</b> ${data["CUSTOMER NAME"]}</p>
          <p><b>Address:</b> ${data["ADDRESS"]}</p>
          <label for="agentName">Agent Name:</label>
          <select id="agentName">
            <option>${data["AGENT NAME"] || "Select"}</option>
            <option>Agent A</option>
            <option>Agent B</option>
          </select>
          <br>
          <label for="agentRemark">Agent Remark:</label>
          <select id="agentRemark">
            <option>${data["AGENT REMARK 1"] || "Select"}</option>
            <option>Remark A</option>
            <option>Remark B</option>
          </select>
          <br>
          <label for="attemptNumber">Attempt Number:</label>
          <select id="attemptNumber">
            <option>${data["ATEEMPT NUMBER"] || "Select"}</option>
            <option>1</option>
            <option>2</option>
          </select>
          <br>
          <button onclick="submitUpdate('${data["ORDER ID"]}')">Submit</button>
        </div>
      `;
    }

    async function submitUpdate(orderId) {
      const agentName = document.getElementById("agentName").value;
      const agentRemark = document.getElementById("agentRemark").value;
      const attemptNumber = document.getElementById("attemptNumber").value;

      const response = await fetch(webAppURL, {
        method: "POST",
        body: JSON.stringify({
          orderId,
          agentName,
          agentRemark,
          attemptNumber,
        }),
      });

      const result = await response.json();
      alert(result.success ? "Update successful!" : result.error);
    }
  </script>
</body>
